<% content_for :meta_title, t('.title', name: @entity.name) %>
<% content_for :hide_sidebar, '1' %>

<article class="entity-page">
  <h1><%= @entity.name %></h1>

  <ul class="actions">
    <li><%= return_icon(admin_privileges_path) %></li>
    <% unless @entity.locked? %>
        <li><%= edit_icon(edit_privilege_path(@entity.id)) %></li>
    <% end %>
  </ul>

  <table>
    <tbody>
    <% unless @entity.parent.nil? %>
        <tr>
          <th><%= t('activerecord.attributes.privilege.parent_id') %></th>
          <td><%= link_to @entity.parent.name, admin_privilege_path(@entity.parent_id) %></td>
        </tr>
    <% end %>
    <tr>
      <th><%= t('activerecord.attributes.privilege.slug') %></th>
      <td><%= @entity.slug %></td>
    </tr>
    <tr>
      <th><%= t('activerecord.attributes.privilege.priority') %></th>
      <td><%= @entity.priority %></td>
    </tr>
    <% unless @entity.description.blank? %>
        <tr>
          <th><%= t('activerecord.attributes.privilege.description') %></th>
          <td><%= simple_format(@entity.description) %></td>
        </tr>
    <% end %>
    <% unless @entity.parents_cache.blank? %>
        <tr>
          <th><%= t('activerecord.attributes.privilege.parents_cache') %></th>
          <td><%= @entity.parents_cache %></td>
        </tr>
    <% end %>
    <% unless @entity.children_cache.blank? %>
        <tr>
          <th><%= t('activerecord.attributes.privilege.children_cache') %></th>
          <td><%= @entity.children_cache.join(', ') %></td>
        </tr>
    <% end %>
    <tr>
      <td colspan="2">
        <%= link_to t(:user_count, count: @entity.users_count), users_admin_privilege_path(@entity.id) %>
      </td>
    </tr>
    </tbody>
  </table>

  <%= render partial: 'admin/privileges/entity/groups', locals: { privilege: @entity } %>

  <section>
    <h2><%= t('.children') %></h2>

    <%= render partial: 'admin/privileges/list', locals: { collection: Privilege.for_tree(@entity.id) } %>
  </section>

  <section>
    <h2><%= t('.add_child') %></h2>

    <%= render partial: 'privileges/form', locals: { entity: Privilege.new(parent: @entity) } %>
  </section>
</article>
